# =============================================================================
# 零售業簡易ERP系統 - 測試環境配置
# =============================================================================
# 說明：使用 H2 內嵌資料庫進行單元測試與整合測試
# =============================================================================

spring:
  # ==========================================================================
  # 資料庫配置 - 使用 H2 內嵌資料庫
  # ==========================================================================
  datasource:
    # H2 記憶體資料庫，使用 MySQL 相容模式
    url: jdbc:h2:mem:testdb;MODE=MySQL;DATABASE_TO_LOWER=TRUE;CASE_INSENSITIVE_IDENTIFIERS=TRUE
    driver-class-name: org.h2.Driver
    username: sa
    password:

  # ==========================================================================
  # JPA 配置
  # ==========================================================================
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      # 測試環境使用 create-drop，每次測試自動建立與刪除表
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  # ==========================================================================
  # Flyway 配置 - 測試環境停用
  # ==========================================================================
  flyway:
    enabled: false

  # ==========================================================================
  # Redis 配置 - 測試環境使用 Docker Redis（CI 環境使用 embedded-redis）
  # ==========================================================================
  data:
    redis:
      host: localhost
      port: 6385

  # ==========================================================================
  # H2 Console - 方便除錯（可選）
  # ==========================================================================
  h2:
    console:
      enabled: true
      path: /h2-console

# =============================================================================
# 伺服器配置
# =============================================================================
server:
  port: 0  # 使用隨機埠避免測試衝突

# =============================================================================
# JWT 配置
# =============================================================================
app:
  jwt:
    # 測試用密鑰（至少256位元）
    secret: test-secret-key-for-jwt-token-generation-must-be-at-least-256-bits-long-for-hs256-algorithm
    # Token 有效期 1 小時（測試用）
    expiration: 3600000
    # Refresh Token 有效期 1 天（測試用）
    refresh-expiration: 86400000
    prefix: Bearer
    header: Authorization

  # ==========================================================================
  # CORS 配置
  # ==========================================================================
  cors:
    allowed-origins: http://localhost:3000
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH
    allowed-headers: "*"
    allow-credentials: true
    max-age: 3600

  # ==========================================================================
  # 分頁配置
  # ==========================================================================
  pagination:
    default-size: 10
    max-size: 50

  # ==========================================================================
  # 安全配置 - 白名單路徑（使用逗號分隔以相容 @Value 註解）
  # ==========================================================================
  security:
    whitelist: /api/v1/auth/**,/actuator/**,/swagger-ui/**,/api-docs/**,/v3/api-docs/**,/h2-console/**

# =============================================================================
# 日誌配置 - 測試環境降低日誌等級
# =============================================================================
logging:
  level:
    root: WARN
    com.kamesan.erpapi: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
